# Auth Server Environment Configuration Example
# Copy this file to .env.local and fill in the actual values

############ SERVER ENV ###########
# 애플리케이션 실행 환경
NODE_ENV=development
# HTTP API 서버 포트 (클라이언트 접근용)
PORT=8000
# TCP 마이크로서비스 포트 (서비스간 통신용)
TCP_PORT=8010
# CORS 허용 도메인 (콤마로 구분)
CORS_ORIGINS="http://localhost:3000, http://127.0.0.1:3000, http://localhost:3200, http://localhost:3210, http://localhost:3300, http://localhost:3310"
# 애플리케이션 이름
APP_NAME=auth-server
# 서버 URL (이미지 URL 생성용)
AUTH_SERVER_URL=http://localhost:8000/auth
# 클라이언트 애플리케이션 URL
AUTH_CLIENT_URL=http://localhost:3000
PORTAL_CLIENT_URL=http://localhost:3200
ALLOWED_REDIRECT_DOMAINS="localhost, localhost:3000, localhost:3200, localhost:3210, localhost:3010, localhost:3020, 127.0.0.1:3000"
ALLOWED_REDIRECT_PROTOCOLS="http, https"

############ EXTERNAL SERVICE ENDPOINTS ############
# MSA 서비스 통신 설정
AUTHZ_SERVICE_HOST=authz-server
AUTHZ_SERVICE_PORT=8110
PORTAL_SERVICE_HOST=portal-server
PORTAL_SERVICE_PORT=8210
MYPICK_SERVICE_HOST=my-pick-server
MYPICK_SERVICE_PORT=8310

############ MYSQL ENV ############
# 중앙 인프라 MySQL 서버 (krgeobuk-infrastructure에서 제공)
MYSQL_HOST=krgeobuk-mysql
# MySQL 내부 포트 (컨테이너간 통신용)
MYSQL_PORT=3306
# MySQL 사용자명 (중앙 인프라 dev 사용자)
MYSQL_USER=dev_user
# MySQL 사용자 비밀번호 (krgeobuk-infrastructure/.env의 MYSQL_DEV_USER_PASSWORD와 일치 필요)
MYSQL_PASSWORD=your-mysql-dev-password
# MySQL 데이터베이스 이름 (중앙 인프라 auth_dev)
MYSQL_DATABASE=auth_dev

############ REDIS ENV ############
# 중앙 인프라 Redis 서버 (krgeobuk-infrastructure에서 제공)
REDIS_HOST=krgeobuk-redis
# Redis 내부 포트 (컨테이너간 통신용)
REDIS_PORT=6379
# Redis 비밀번호 (krgeobuk-infrastructure/.env의 REDIS_PASSWORD와 일치 필요)
REDIS_PASSWORD=your-redis-password
# Redis 키 환경별 분리를 위한 prefix (선택사항)
# - 개발 환경: dev, staging 등의 값 사용
# - 프로덕션: 빈 문자열 또는 prod 사용
# - 로컬 테스트: local 또는 빈 문자열
# 예: REDIS_KEY_PREFIX=dev → "dev:refreshToken", "dev:blacklist:123"
#     REDIS_KEY_PREFIX= → "refreshToken", "blacklist:123"
REDIS_KEY_PREFIX=

############ GOOGLE OAUTH ENV ############
# Google OAuth 클라이언트 ID (Google Cloud Console에서 발급)
GOOGLE_CLIENT_ID=your-google-client-id.apps.googleusercontent.com
# Google OAuth 클라이언트 시크릿 (Google Cloud Console에서 발급)
GOOGLE_CLIENT_SECRET=your-google-client-secret
# Google OAuth 콜백 URL
GOOGLE_REDIRECT_URL=http://localhost:8000/api/oauth/login-google/callback
# Google OAuth 토큰 URL (고정값)
GOOGLE_TOKEN_URL=https://oauth2.googleapis.com/token
# Google 사용자 정보 API URL (고정값)
GOOGLE_USERINFO_URL=https://www.googleapis.com/oauth2/v2/userinfo

############ NAVER OAUTH ENV ############
# Naver OAuth 클라이언트 ID (Naver Developers에서 발급)
NAVER_CLIENT_ID=your-naver-client-id
# Naver OAuth 클라이언트 시크릿 (Naver Developers에서 발급)
NAVER_CLIENT_SECRET=your-naver-client-secret
# Naver OAuth 콜백 URL
NAVER_REDIRECT_URL=http://localhost:8000/api/oauth/login-naver/callback
# Naver OAuth 토큰 URL (고정값)
NAVER_TOKEN_URL=https://nid.naver.com/oauth2.0/token
# Naver 사용자 정보 API URL (고정값)
NAVER_USERINFO_URL=https://openapi.naver.com/v1/nid/me

############ JWT ENV ############
# JWT 키 파일 경로 (generate-jwt-keys.sh 스크립트로 생성)
JWT_ACCESS_PRIVATE_KEY_PATH=./keys/access-private.key
JWT_ACCESS_PUBLIC_KEY_PATH=./keys/access-public.key
JWT_REFRESH_PRIVATE_KEY_PATH=./keys/refresh-private.key
JWT_REFRESH_PUBLIC_KEY_PATH=./keys/refresh-public.key

# JWT 토큰 만료 시간
JWT_ACCESS_EXPIRES_IN=15m     # Access Token: 15분
JWT_REFRESH_EXPIRES_IN=7d     # Refresh Token: 7일

# JWT 쿠키 설정
JWT_SESSION_COOKIE_PATH=/
JWT_REFRESH_MAX_AGE=604800000    # 7일 (밀리초)
# 쿠키 도메인 설정 (서브도메인 공유용)
# 프로덕션: .yourdomain.com (점으로 시작)
# 개발환경: .localhost (서브도메인 공유)
JWT_COOKIE_DOMAIN=.localhost

############ EMAIL ENV ############
# SMTP 서버 설정
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_SECURE=false
# Gmail 계정 정보 (앱 비밀번호 사용 권장)
SMTP_USER=your-email@gmail.com
SMTP_PASS=your-gmail-app-password
# 발송자 정보
SMTP_FROM="krgeobuk <noreply@krgeobuk.com>"

# 이메일 인증 설정
EMAIL_VERIFICATION_EXPIRES=86400
EMAIL_VERIFICATION_BASE_URL=http://localhost:3000

# ============================================================================
# 설정 가이드
# ============================================================================
#
# 중요: auth-server는 중앙 인프라(krgeobuk-infrastructure)를 사용합니다.
#
# 1. 먼저 중앙 인프라를 시작하세요 (필수!):
#    cd ../../krgeobuk-infrastructure/docker-compose/
#    docker-compose up -d
#
# 2. 이 파일을 .env.local로 복사하세요:
#    cp .env.example .env.local
#
# 3. 다음 값들을 krgeobuk-infrastructure/.env와 동일하게 설정하세요:
#    - MYSQL_PASSWORD (MYSQL_DEV_USER_PASSWORD와 일치)
#    - REDIS_PASSWORD (REDIS_PASSWORD와 일치)
#
# 4. OAuth 및 SMTP 설정:
#    - GOOGLE_CLIENT_ID, GOOGLE_CLIENT_SECRET
#    - NAVER_CLIENT_ID, NAVER_CLIENT_SECRET
#    - SMTP_USER, SMTP_PASS (Gmail 앱 비밀번호)
#
# 5. JWT 키 파일을 생성하세요:
#    bash script/generate-jwt-keys.sh
#
# 6. OAuth 애플리케이션을 등록하세요:
#    - Google: https://console.cloud.google.com/
#    - Naver: https://developers.naver.com/
#
# 7. Gmail 앱 비밀번호 생성:
#    - Google 계정 > 보안 > 2단계 인증 활성화
#    - 앱 비밀번호 생성 > "기타" 선택 > "krgeobuk" 입력
#    - 생성된 16자리 비밀번호를 SMTP_PASS에 입력
#
# 8. auth-server Docker 컨테이너를 시작하세요:
#    npm run docker:local:up
#
# ============================================================================
# 네트워크 정보
# ============================================================================
#
# auth-server는 다음 네트워크에 연결됩니다:
# - krgeobuk-network: 중앙 인프라 접근 (MySQL, Redis)
# - msa-network: 마이크로서비스 간 통신
# - shared-network: 공유 리소스 접근
#
# 중앙 인프라 서비스:
# - MySQL: krgeobuk-mysql:3306 (auth_dev 데이터베이스)
# - Redis: krgeobuk-redis:6379
#
# ============================================================================